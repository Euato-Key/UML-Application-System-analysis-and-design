@startuml
title Activity Diagram: BUC04 呼叫病号
' 设置样式
skinparam backgroundColor white
skinparam activity {
  BackgroundColor<<System>> #E6F7FF
  BorderColor<<System>> #1890FF
  BackgroundColor #White
  BorderColor #333333
  ArrowColor #333333
}

' 定义泳道
|#F0F0F0|Doctor| 医生
|#E6F7FF|System| 智能候诊系统
|#F0F0F0|Student| 学生
|#F0FFF0|Nurse| 护士

' 开始流程
|Doctor|
start
:点击工作台 "叫号" 按钮;

|System|
:查询当前科室候诊队列;

if (队列是否为空?) then (是)
    :返回提示 "当前无候诊病人";
    stop
else (否)
    partition "自动分配核心逻辑" {
        :锁定队列首位学生 (Top 1);
        note right
          防止多位医生同时点击
          导致并发冲突(Race Condition)
        end note
        
        :将该学生与当前医生/诊室绑定;
        note right
          业务规则：
          动态分配，负载均衡
        end note
        
        :将学生状态更新为 "呼叫中";
        :从候诊队列移出 -> 进入就诊缓冲池;
    }
endif

' 并行处理通知与数据加载
fork
    |System|
    :向走廊大屏/广播发送呼叫指令;
    :向学生手机推送 App 通知;
    
    |Student|
    :接收弹窗通知 "请前往 XX 诊室";
    :听到广播呼叫;
    
fork again
    |System|
    :检索该学生的电子病历(EMR);
    :加载历史诊断记录;
    
    |Doctor|
    :工作台界面刷新;
    :显示当前病人姓名及病历详情;
    
fork again
    |System|
    :更新分诊台监控列表;
    
    |Nurse|
    :看到该学生状态变为 "就诊中";
    :知晓该学生去向;
end fork

|Doctor|
:等待学生进入诊室;

stop
@enduml