### 第一部分：功能清单 (Functional Breakdown)

基于参与者视角，我们将用例拆解为具体的功能模块。

#### 1. 参与者：运维工程师 (DevOps Engineer)
**核心职责：** 设备的“生老病死”全生命周期管理，确保图谱数据的准确性与安全性。

| 一级功能 | 二级功能 | 对应业务用例 |
| :--- | :--- | :--- |
| **设备接入管理** | **证书双向认证**：校验设备端证书合法性，拒绝未授权设备。<br>**自动发现与注册**：接收MQTT上线消息，创建基础设备档案。 | UC-01 |
| **拓扑图谱构建** | **空间关系定义**：绑定设备与物理空间（楼宇/楼层/房间）的归属关系。<br>**网络拓扑映射**：定义设备与网关/交换机的连接关系。<br>**节点可视化编辑**：在画布上拖拽调整节点位置与属性。 | UC-02 |
| **远程控制中心** | **指令翻译与下发**：将标准指令转化为特定协议指令发送给设备。<br>**批量操作执行**：对选定设备组执行重启、配置重置等操作。 | UC-05 |
| **固件版本管理** | **灰度策略配置**：设定灰度测试的设备范围与比例。<br>**全量推送升级**：监控升级进度，统计成功/失败率。 | UC-06 |
| **安全与生命周期** | **威胁阻断**：识别DDoS或异常流量，自动/手动切断连接。<br>**设备退役清洗**：执行数据擦除、凭证吊销与图谱关系解绑。 | UC-07, UC-08 |

#### 2. 参与者：运营经理 (Operations Manager)
**核心职责：** 业务洞察、宏观决策，依赖自然语言交互。

| 一级功能 | 二级功能 | 对应业务用例 |
| :--- | :--- | :--- |
| **智能交互分析** | **自然语言问答**：解析用户口语化问题（如“哪里空调坏了”）。<br>**归因分析报告**：基于图谱关系链，自动生成故障根因分析文本。 | UC-04 |
| **全景监控看板** | **状态实时映射**：在3D/2D拓扑图上通过颜色区分设备在线/离线/告警状态。<br>**影响范围可视**：高亮显示故障节点及其下游受影响的节点路径。 | UC-03 |

---

### 第二部分：核心用例详述 (Use Case Specification)

以下选取的三个用例涵盖了系统的三大核心技术特征：**图数据库写入（UC-02）**、**大模型交互（UC-04）**、**复杂业务流程（UC-07）**。

#### 1. 用例 UC-02：构建拓扑关系 (Maintain Graph Topology)

*   **简述**：运维工程师在设备注册后，定义其在知识图谱中的物理位置与网络连接关系。
*   **前置条件**：设备已完成基础注册（UC-01），处于“待配置”状态。
*   **后置条件**：知识图谱中新增了该设备节点，且建立了指向“空间”和“网关”的关系边。

| 步骤 | **主成功场景 (Main Success Scenario)** |
| :--- | :--- |
| 1 | 运维工程师在待配置列表中选中新接入设备（如“温湿度传感器-01”）。 |
| 2 | 系统加载当前的空间树（楼宇-楼层-房间）和网关列表。 |
| 3 | 工程师指定该设备归属于“A栋-301室”，并连接至“网关-G05”。 |
| 4 | 系统校验关联的有效性（如：网关G05是否实际位于A栋）。 |
| 5 | **系统执行Cypher语句**（如 `MATCH (r:Room), (d:Device) MERGE (d)-[:LOCATED_IN]->(r)`），在图数据库中创建设备节点及关联边。 |
| 6 | 系统在前端可视化画布上自动渲染新节点，并高亮显示其与房间、网关的连线。 |

*   **扩展/异常场景**：
    *   **3a. 空间节点不存在**：工程师发现“301室”未在系统中定义。
        *   3a1. 工程师选择“新建空间节点”，输入房间信息。
        *   3a2. 系统在图谱中创建新的Room节点，流程返回步骤3。
    *   **4a. 逻辑冲突**：系统检测到该网关已挂载超过最大限制数量的子设备。
        *   4a1. 系统提示“网关负载已满”，阻止关系建立。

---

#### 2. 用例 UC-04：智能查询图谱 (Intelligent QA Diagnosis)

*   **简述**：运营经理通过自然语言提问，系统利用大模型（LLM）解析意图并查询知识图谱，返回分析结果。
*   **前置条件**：系统的大模型服务在线，知识图谱数据已同步。
*   **后置条件**：界面展示自然语言回答及对应的图谱子图。

| 步骤 | **主成功场景 (Main Success Scenario)** |
| :--- | :--- |
| 1 | 运营经理在对话框输入：“*帮我查一下A栋所有温度异常的传感器，是不是空调坏了？*” |
| 2 | **大模型(Agent)** 解析自然语言，识别实体（A栋、传感器、空调）和意图（查询状态、关联分析）。 |
| 3 | **大模型(Agent)** 生成对应的 **Cypher查询语句**（如查找同房间内既有高温传感器又有空调的子图）。 |
| 4 | 系统在图数据库（Neo4j）中执行生成的查询语句。 |
| 5 | 图数据库返回结构化数据（受影响的传感器节点列表及其关联的空调节点）。 |
| 6 | **大模型(Agent)** 根据返回数据生成自然语言总结：“*发现A栋301、302室温度超标。关联分析显示，这两间房均由'空调主机-Unit3'供冷，建议检查该主机。*” |
| 7 | 系统在界面右侧同步渲染出包含相关房间、传感器和空调主机的**局部关系图**。 |

*   **扩展/异常场景**：
    *   **3a. 意图模糊**：大模型无法确定“异常”的具体阈值。
        *   3a1. 系统反问：“*请问温度超过多少度视为异常？*”
        *   3a2. 经理补充信息后，流程重试。
    *   **4a. 查询超时或语法错误**：生成的Cypher语句执行失败。
        *   4a1. 系统捕获错误，反馈“查询过于复杂，正在尝试简化搜索范围”，并记录错误日志供模型微调。

---

#### 3. 用例 UC-07：退役报废设备 (Decommission Device)

*   **简述**：安全地将设备下线，确保物理数据擦除、逻辑凭证失效以及图谱关系的清理。
*   **前置条件**：设备需处于在线状态（以便擦除数据），或已确认物理丢失。
*   **后置条件**：设备敏感数据被清空，图谱中节点状态变为“已报废”，且与其他活跃节点无关联。

| 步骤 | **主成功场景 (Main Success Scenario)** |
| :--- | :--- |
| 1 | 运维工程师在系统发起对“摄像头-C12”的“退役流程”。 |
| 2 | 系统向设备下发**“数据安全擦除”指令**（清除本地存储的人脸特征码、日志）。 |
| 3 | 设备反馈“擦除成功”，系统吊销该设备的访问证书（Cert）。 |
| 4 | **系统更新知识图谱**：删除该设备与房间（LOCATED_IN）及网关（CONNECTED_TO）的主动关联边，防止产生僵尸路径。 |
| 5 | 系统将图谱中该设备节点的属性更新为 `status: "RETIRED"`（保留节点用于历史审计，但不再参与实时计算）。 |
| 6 | 系统将该设备的生命周期日志归档至冷存储。 |
| 7 | 系统提示工程师“设备退役完成，可以进行物理拆除”。 |

*   **扩展/异常场景**：
    *   **2a. 设备已离线/损坏**：系统无法连接设备执行擦除。
        *   2a1. 系统提示“设备无法连接，远程擦除失败”。
        *   2a2. 工程师选择“强制退役（标记为未安全清洗）”。
        *   2a3. 系统记录安全风险日志，建议人工物理销毁存储芯片，流程跳至步骤3。