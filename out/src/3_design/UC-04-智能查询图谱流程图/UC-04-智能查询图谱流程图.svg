<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="937px" preserveAspectRatio="none" style="width:1312px;height:937px;" version="1.1" viewBox="0 0 1312 937" width="1312px" zoomAndPan="magnify"><defs><filter height="300%" id="f17fi5r2h44l3h" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="219" x="545.875" y="30.6279">UC-04 智能查询图谱流程图</text><rect fill="#E6F2FF" height="883.5332" style="stroke:#E6F2FF;stroke-width:1.0;" width="353" x="15" y="37.0381"/><path d="M20,96.6211 L20,159.8843 A0,0 0 0 0 20,159.8843 L198,159.8843 A0,0 0 0 0 198,159.8843 L198,132.2527 L218,128.2527 L198,124.2527 L198,106.6211 L188,96.6211 L20,96.6211 A0,0 0 0 0 20,96.6211 " fill="#FBFB77" filter="url(#f17fi5r2h44l3h)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M188,96.6211 L188,106.6211 L198,106.6211 L188,96.6211 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="26" y="116.519">示例：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="26" y="134.2734">"A栋所有温度异常的传感器</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="26" y="152.0278">是不是空调坏了？"</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="116" x="218" y="110.0583"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="228" y="133.8103">输入自然语言问题</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="104" x="153" y="341.2217"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="163" y="364.9736">补充上下文信息</text><ellipse cx="205" cy="408.6104" fill="#FFFFFF" filter="url(#f17fi5r2h44l3h)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="205" cy="408.6104" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="164" x="194" y="842.1826"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="204" y="865.9346">阅读报告并查看可视化图谱</text><ellipse cx="276" cy="909.5713" fill="#FFFFFF" filter="url(#f17fi5r2h44l3h)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="276" cy="909.5713" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:2.0;" x1="15" x2="15" y1="37.0381" y2="920.5713"/><rect fill="#F2FFE6" height="883.5332" style="stroke:#F2FFE6;stroke-width:1.0;" width="456.75" x="368" y="37.0381"/><path d="M621.75,175.3242 L621.75,194.0786 L601.75,198.0786 L621.75,202.0786 L621.75,220.833 A0,0 0 0 0 621.75,220.833 L819.75,220.833 A0,0 0 0 0 819.75,220.833 L819.75,185.3242 L809.75,175.3242 L621.75,175.3242 A0,0 0 0 0 621.75,175.3242 " fill="#FBFB77" filter="url(#f17fi5r2h44l3h)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M809.75,175.3242 L809.75,185.3242 L819.75,185.3242 L809.75,175.3242 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="627.75" y="195.2222">识别实体：A栋, 传感器, 空调</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="627.75" y="212.9766">识别意图：关联分析, 状态查询</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="140" x="461.75" y="179.8843"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="471.75" y="203.6362">大模型解析意图与实体</text><polygon fill="#FEFECE" filter="url(#f17fi5r2h44l3h)" points="506.75,240.833,556.75,240.833,568.75,252.833,556.75,264.833,506.75,264.833,494.75,252.833,506.75,240.833" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="506.75" y="257.9275">意图清晰?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="483.75" y="250.416">否</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="568.75" y="250.416">是</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="92" x="414.75" y="284.833"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72" x="424.75" y="308.585">生成澄清反问</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="119" x="543.25" y="284.833"/><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="99" x="553.25" y="308.585">Text2Cypher 转换</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="140" x="532.75" y="341.2217"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="542.75" y="364.9736">生成图数据库查询语句</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="152" x="374" y="574.6279"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="132" x="384" y="598.3799">捕获错误并尝试简化查询</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="92" x="404" y="631.0166"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72" x="414" y="654.7686">返回友好提示</text><ellipse cx="450" cy="698.4053" fill="#FFFFFF" filter="url(#f17fi5r2h44l3h)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="450" cy="698.4053" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="164" x="449.75" y="729.4053"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="459.75" y="753.1572">基于数据生成自然语言总结</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="152" x="455.75" y="785.7939"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="132" x="465.75" y="809.5459">渲染受影响的设备拓扑图</text><line style="stroke:#000000;stroke-width:2.0;" x1="368" x2="368" y1="37.0381" y2="920.5713"/><rect fill="#FFF2E6" height="883.5332" style="stroke:#FFF2E6;stroke-width:1.0;" width="468.5" x="824.75" y="37.0381"/><ellipse cx="924.75" cy="76.6211" fill="#000000" filter="url(#f17fi5r2h44l3h)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><path d="M1001.25,429.6104 L1001.25,466.1191 L981.25,470.1191 L1001.25,474.1191 L1001.25,510.6279 A0,0 0 0 0 1001.25,510.6279 L1288.25,510.6279 A0,0 0 0 0 1288.25,510.6279 L1288.25,439.6104 L1278.25,429.6104 L1001.25,429.6104 A0,0 0 0 0 1001.25,429.6104 " fill="#FBFB77" filter="url(#f17fi5r2h44l3h)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1278.25,429.6104 L1278.25,439.6104 L1288.25,439.6104 L1278.25,429.6104 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="1007.25" y="449.5083">MATCH (s:Sensor)-[:LOCATED_IN]-&gt;(r:Room)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1007.25" y="467.2627">WHERE s.temp &gt; 30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="1007.25" y="485.0171">MATCH (ac:AC)-[:COOLS]-&gt;(r)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="1007.25" y="502.7715">RETURN s, r, ac</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="113" x="868.25" y="451.9248"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="93" x="878.25" y="475.6768">执行 Cypher 查询</text><polygon fill="#FEFECE" filter="url(#f17fi5r2h44l3h)" points="899.75,530.6279,949.75,530.6279,961.75,542.6279,949.75,554.6279,899.75,554.6279,887.75,542.6279,899.75,530.6279" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="899.75" y="547.7224">查询成功?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="58" x="829.75" y="540.2109">否/语法错误</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="961.75" y="540.2109">是</text><rect fill="#E6E6FA" filter="url(#f17fi5r2h44l3h)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#4B0082;stroke-width:1.5;" width="135" x="939" y="574.6279"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="949" y="598.3799">返回子图数据 (JSON)</text><line style="stroke:#000000;stroke-width:2.0;" x1="824.75" x2="824.75" y1="37.0381" y2="920.5713"/><line style="stroke:#000000;stroke-width:2.0;" x1="1293.25" x2="1293.25" y1="37.0381" y2="920.5713"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="205" x2="205" y1="377.6104" y2="397.6104"/><polygon fill="#4B0082" points="201,387.6104,205,397.6104,209,387.6104,205,391.6104" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="276" x2="276" y1="878.5713" y2="898.5713"/><polygon fill="#4B0082" points="272,888.5713,276,898.5713,280,888.5713,276,892.5713" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="602.75" x2="602.75" y1="321.2217" y2="341.2217"/><polygon fill="#4B0082" points="598.75,331.2217,602.75,341.2217,606.75,331.2217,602.75,335.2217" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="494.75" x2="460.75" y1="252.833" y2="252.833"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="460.75" x2="460.75" y1="252.833" y2="284.833"/><polygon fill="#4B0082" points="456.75,274.833,460.75,284.833,464.75,274.833,460.75,278.833" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="568.75" x2="602.75" y1="252.833" y2="252.833"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="602.75" x2="602.75" y1="252.833" y2="284.833"/><polygon fill="#4B0082" points="598.75,274.833,602.75,284.833,606.75,274.833,602.75,278.833" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="602.75" x2="602.75" y1="377.6104" y2="424.6104"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="602.75" x2="924.75" y1="424.6104" y2="424.6104"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="924.75" x2="924.75" y1="424.6104" y2="451.9248"/><polygon fill="#4B0082" points="920.75,441.9248,924.75,451.9248,928.75,441.9248,924.75,445.9248" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="531.75" x2="531.75" y1="216.2729" y2="240.833"/><polygon fill="#4B0082" points="527.75,230.833,531.75,240.833,535.75,230.833,531.75,234.833" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="450" x2="450" y1="611.0166" y2="631.0166"/><polygon fill="#4B0082" points="446,621.0166,450,631.0166,454,621.0166,450,625.0166" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="450" x2="450" y1="667.4053" y2="687.4053"/><polygon fill="#4B0082" points="446,677.4053,450,687.4053,454,677.4053,450,681.4053" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="531.75" x2="531.75" y1="765.7939" y2="785.7939"/><polygon fill="#4B0082" points="527.75,775.7939,531.75,785.7939,535.75,775.7939,531.75,779.7939" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="961.75" x2="1006.5" y1="542.6279" y2="542.6279"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="1006.5" x2="1006.5" y1="542.6279" y2="574.6279"/><polygon fill="#4B0082" points="1002.5,564.6279,1006.5,574.6279,1010.5,564.6279,1006.5,568.6279" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="1006.5" x2="1006.5" y1="611.0166" y2="714.4053"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="1006.5" x2="531.75" y1="714.4053" y2="714.4053"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="531.75" x2="531.75" y1="714.4053" y2="729.4053"/><polygon fill="#4B0082" points="527.75,719.4053,531.75,729.4053,535.75,719.4053,531.75,723.4053" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="924.75" x2="924.75" y1="488.3135" y2="530.6279"/><polygon fill="#4B0082" points="920.75,520.6279,924.75,530.6279,928.75,520.6279,924.75,524.6279" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="924.75" x2="924.75" y1="86.6211" y2="91.6211"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="924.75" x2="276" y1="91.6211" y2="91.6211"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="276" x2="276" y1="91.6211" y2="110.0583"/><polygon fill="#4B0082" points="272,100.0583,276,110.0583,280,100.0583,276,104.0583" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="276" x2="276" y1="146.447" y2="164.8843"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="276" x2="531.75" y1="164.8843" y2="164.8843"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="531.75" x2="531.75" y1="164.8843" y2="179.8843"/><polygon fill="#4B0082" points="527.75,169.8843,531.75,179.8843,535.75,169.8843,531.75,173.8843" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="460.75" x2="460.75" y1="321.2217" y2="326.2217"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="460.75" x2="205" y1="326.2217" y2="326.2217"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="205" x2="205" y1="326.2217" y2="341.2217"/><polygon fill="#4B0082" points="201,331.2217,205,341.2217,209,331.2217,205,335.2217" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="887.75" x2="450" y1="542.6279" y2="542.6279"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="450" x2="450" y1="542.6279" y2="574.6279"/><polygon fill="#4B0082" points="446,564.6279,450,574.6279,454,564.6279,450,568.6279" style="stroke:#4B0082;stroke-width:1.0;"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="531.75" x2="531.75" y1="822.1826" y2="827.1826"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="531.75" x2="276" y1="827.1826" y2="827.1826"/><line style="stroke:#4B0082;stroke-width:1.5;" x1="276" x2="276" y1="827.1826" y2="842.1826"/><polygon fill="#4B0082" points="272,832.1826,276,842.1826,280,832.1826,276,836.1826" style="stroke:#4B0082;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="125" x="129" y="57.666">用户 (运营经理)</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="201" x="495.875" y="57.666">IoT交互平台 (LLM Agent)</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="172" x="973" y="57.666">知识图谱引擎 (Neo4j)</text><!--MD5=[c98a9aa2a39d7a349a45c0a95ec95dc3]
@startuml
title UC-04 智能查询图谱流程图
skinparam ActivityBackgroundColor #E6E6FA
skinparam ActivityBorderColor #4B0082
skinparam ArrowColor #4B0082

|#E6F2FF|用户 (运营经理)|
|#F2FFE6|IoT交互平台 (LLM Agent)|
|#FFF2E6|知识图谱引擎 (Neo4j)|

start

|用户 (运营经理)|
:输入自然语言问题;
note left
    示例：
    "A栋所有温度异常的传感器
    是不是空调坏了？"
end note

|IoT交互平台 (LLM Agent)|
:大模型解析意图与实体;
note right
    识别实体：A栋, 传感器, 空调
    识别意图：关联分析, 状态查询
end note

if (意图清晰?) then (否)
    :生成澄清反问;
    |用户 (运营经理)|
    :补充上下文信息;
    stop
else (是)
    |IoT交互平台 (LLM Agent)|
    :**Text2Cypher 转换**;
    :生成图数据库查询语句;
endif

|知识图谱引擎 (Neo4j)|
:执行 Cypher 查询;
note right
    MATCH (s:Sensor)-[:LOCATED_IN]->(r:Room)
    WHERE s.temp > 30
    MATCH (ac:AC)-[:COOLS]->(r)
    RETURN s, r, ac
end note

if (查询成功?) then (否/语法错误)
    |IoT交互平台 (LLM Agent)|
    :捕获错误并尝试简化查询;
    :返回友好提示;
    stop
else (是)
    |知识图谱引擎 (Neo4j)|
    :返回子图数据 (JSON);
endif

|IoT交互平台 (LLM Agent)|
:基于数据生成自然语言总结;
:渲染受影响的设备拓扑图;

|用户 (运营经理)|
:阅读报告并查看可视化图谱;

stop
@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 CST 2021)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>