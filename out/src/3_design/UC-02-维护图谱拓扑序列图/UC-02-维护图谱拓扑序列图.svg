<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="816px" preserveAspectRatio="none" style="width:1006px;height:816px;" version="1.1" viewBox="0 0 1006 816" width="1006px" zoomAndPan="magnify"><defs><filter height="300%" id="f10wbd1r0za4o5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="219" x="391.5" y="32.6279">UC-02 维护图谱拓扑序列图</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="571.8706" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="139.7031"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="530.3618" style="stroke:#A80036;stroke-width:1.0;" width="10" x="260" y="181.2119"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="474.853" style="stroke:#A80036;stroke-width:1.0;" width="10" x="455" y="212.9663"/><rect fill="#E9967A" filter="url(#f10wbd1r0za4o5)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="460" y="260.0979"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="31.7544" style="stroke:#A80036;stroke-width:1.0;" width="10" x="630" y="441.5386"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="91.2632" style="stroke:#A80036;stroke-width:1.0;" width="10" x="728.5" y="549.8018"/><rect fill="#FFFFFF" filter="url(#f10wbd1r0za4o5)" height="363.3442" style="stroke:#000000;stroke-width:2.0;" width="982" x="10" y="317.4751"/><rect fill="#FFFFFF" height="280.0581" style="stroke:none;stroke-width:1.0;" width="982" x="10" y="400.7612"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="58" x2="58" y1="129.7031" y2="729.5737"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="264.5" x2="264.5" y1="129.7031" y2="729.5737"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="460" x2="460" y1="129.7031" y2="729.5737"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="634.5" x2="634.5" y1="129.7031" y2="729.5737"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="733.5" x2="733.5" y1="129.7031" y2="729.5737"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="20" y="126.627">运维工程师</text><ellipse cx="58" cy="53.583" fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M58,61.583 L58,88.583 M45,69.583 L71,69.583 M58,88.583 L45,103.583 M58,88.583 L71,103.583 " fill="none" filter="url(#f10wbd1r0za4o5)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="20" y="744.6177">运维工程师</text><ellipse cx="58" cy="757.6938" fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M58,765.6938 L58,792.6938 M45,773.6938 L71,773.6938 M58,792.6938 L45,807.6938 M58,792.6938 L71,807.6938 " fill="none" filter="url(#f10wbd1r0za4o5)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="103" x="211.5" y="91.583"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="218.5" y="114.627">:Web管理门户</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="103" x="211.5" y="728.5737"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="218.5" y="751.6177">:Web管理门户</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="124" x="396" y="91.583"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="403" y="114.627">:TopologyService</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="124" x="396" y="728.5737"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="403" y="751.6177">:TopologyService</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="61" x="602.5" y="91.583"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="609.5" y="114.627">:Device</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="61" x="602.5" y="728.5737"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="609.5" y="751.6177">:Device</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="52.2402" style="stroke:#A80036;stroke-width:1.5;" width="108" x="677.5" y="72.4629"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="684.5" y="95.5068">:GraphAdapter</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="708.5" y="114.627">(Neo4j)</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="52.2402" style="stroke:#A80036;stroke-width:1.5;" width="108" x="677.5" y="728.5737"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="684.5" y="751.6177">:GraphAdapter</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="708.5" y="770.7378">(Neo4j)</text><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="571.8706" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="139.7031"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="530.3618" style="stroke:#A80036;stroke-width:1.0;" width="10" x="260" y="181.2119"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="474.853" style="stroke:#A80036;stroke-width:1.0;" width="10" x="455" y="212.9663"/><rect fill="#E9967A" filter="url(#f10wbd1r0za4o5)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="460" y="260.0979"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="31.7544" style="stroke:#A80036;stroke-width:1.0;" width="10" x="630" y="441.5386"/><rect fill="#FEFECE" filter="url(#f10wbd1r0za4o5)" height="91.2632" style="stroke:#A80036;stroke-width:1.0;" width="10" x="728.5" y="549.8018"/><polygon fill="#A80036" points="248,177.2119,258,181.2119,248,185.2119,252,181.2119" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="254" y1="181.2119" y2="181.2119"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="70" y="167.4783">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="81" y="158.6011">提交拓扑配置</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="81" y="176.3555">(deviceId, roomId, gatewayId)</text><polygon fill="#A80036" points="443,208.9663,453,212.9663,443,216.9663,447,212.9663" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="270" x2="449" y1="212.9663" y2="212.9663"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="277" y="208.1099">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="288" y="208.1099">bindTopology(cmd)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="470" x2="512" y1="252.0979" y2="252.0979"/><line style="stroke:#A80036;stroke-width:1.0;" x1="512" x2="512" y1="252.0979" y2="265.0979"/><line style="stroke:#A80036;stroke-width:1.0;" x1="471" x2="512" y1="265.0979" y2="265.0979"/><polygon fill="#A80036" points="481,261.0979,471,265.0979,481,269.0979,477,265.0979" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="477" y="247.2415">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="488" y="247.2415">validateLogic()</text><path d="M582,225.9663 L582,270.9663 L694,270.9663 L694,235.9663 L684,225.9663 L582,225.9663 " fill="#FBFB77" filter="url(#f10wbd1r0za4o5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M684,225.9663 L684,235.9663 L694,235.9663 L684,225.9663 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="588" y="245.8643">校验网关容量、</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="588" y="263.6187">房间是否存在</text><path d="M10,317.4751 L71,317.4751 L71,326.4751 L61,336.4751 L10,336.4751 L10,317.4751 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="363.3442" style="stroke:#000000;stroke-width:2.0;" width="982" x="10" y="317.4751"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="333.373">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="52" x="86" y="332.0811">[校验失败]</text><polygon fill="#A80036" points="281,357.0068,271,361.0068,281,365.0068,277,361.0068" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="275" x2="454" y1="361.0068" y2="361.0068"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="287" y="356.1504">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="298" y="356.1504">throw ValidationException</text><polygon fill="#A80036" points="74,388.7612,64,392.7612,74,396.7612,70,392.7612" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="68" x2="259" y1="392.7612" y2="392.7612"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="80" y="387.9048">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="91" y="387.9048">显示错误提示</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="992" y1="401.7612" y2="401.7612"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="52" x="15" y="414.3672">[校验通过]</text><polygon fill="#A80036" points="618,437.5386,628,441.5386,618,445.5386,622,441.5386" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465" x2="624" y1="441.5386" y2="441.5386"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="472" y="436.6821">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="483" y="436.6821">updateLocation(roomId)</text><polygon fill="#A80036" points="476,469.293,466,473.293,476,477.293,472,473.293" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="470" x2="634" y1="473.293" y2="473.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="482" y="468.4365">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="493" y="468.4365">ok</text><line style="stroke:#A80036;stroke-width:1.0;" x1="465" x2="507" y1="505.0474" y2="505.0474"/><line style="stroke:#A80036;stroke-width:1.0;" x1="507" x2="507" y1="505.0474" y2="518.0474"/><line style="stroke:#A80036;stroke-width:1.0;" x1="466" x2="507" y1="518.0474" y2="518.0474"/><polygon fill="#A80036" points="476,514.0474,466,518.0474,476,522.0474,472,518.0474" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="472" y="500.1909">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="483" y="500.1909">buildMergeCypher()</text><polygon fill="#A80036" points="716.5,545.8018,726.5,549.8018,716.5,553.8018,720.5,549.8018" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465" x2="722.5" y1="549.8018" y2="549.8018"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="472" y="544.9453">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="483" y="544.9453">execute(cypherStmt)</text><path d="M743,562.8018 L743,607.8018 L978,607.8018 L978,572.8018 L968,562.8018 L743,562.8018 " fill="#FBFB77" filter="url(#f10wbd1r0za4o5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M968,562.8018 L968,572.8018 L978,572.8018 L968,562.8018 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="749" y="582.6997">MERGE (d)-[:LOCATED_IN]-&gt;(r)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="749" y="600.4541">MERGE (d)-[:CONNECTED_TO]-&gt;(g)</text><polygon fill="#A80036" points="476,637.0649,466,641.0649,476,645.0649,472,641.0649" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="470" x2="732.5" y1="641.0649" y2="641.0649"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="482" y="636.2085">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="500" y="636.2085">result(nodesCreated, relsCreated)</text><polygon fill="#A80036" points="281,668.8193,271,672.8193,281,676.8193,277,672.8193" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="275" x2="454" y1="672.8193" y2="672.8193"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="287" y="667.9629">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="305" y="667.9629">return SuccessDTO</text><polygon fill="#A80036" points="69,707.5737,59,711.5737,69,715.5737,65,711.5737" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="264" y1="711.5737" y2="711.5737"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="75" y="706.7173">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="93" y="706.7173">显示"拓扑关系已建立"</text><!--MD5=[9ddb6781fc11fc75ab90f8366d1771ff]
@startuml
title UC-02 维护图谱拓扑序列图
autonumber
skinparam sequence {
    LifeLineBorderColor #A80036
    LifeLineBackgroundColor #FEFECE
    ParticipantBorderColor #A80036
    ParticipantBackgroundColor #FEFECE
    ActorBorderColor #A80036
    ActorBackgroundColor #FEFECE
    ArrowColor #A80036
    BoxBorderColor #A80036
    BoxBackgroundColor #FFFFFF
}

actor "运维工程师" as User
participant ":Web管理门户" as UI
participant ":TopologyService" as Service
participant ":Device" as DeviceEntity
participant ":GraphAdapter\n(Neo4j)" as DB

activate User

User -> UI : 提交拓扑配置\n(deviceId, roomId, gatewayId)
activate UI

UI -> Service : bindTopology(cmd)
activate Service

' - - - 步骤1：业务校验 - - -
Service -> Service : validateLogic()
activate Service #DarkSalmon
    note right: 校验网关容量、\n房间是否存在
deactivate Service

alt 校验失败
    Service - -> UI : throw ValidationException
    UI - -> User : 显示错误提示
else 校验通过
    ' - - - 步骤2：实体状态更新 - - -
    Service -> DeviceEntity : updateLocation(roomId)
    activate DeviceEntity
    DeviceEntity - -> Service : ok
    deactivate DeviceEntity

    ' - - - 步骤3：构建Cypher并执行 - - -
    Service -> Service : buildMergeCypher()
    
    Service -> DB : execute(cypherStmt)
    activate DB
    note right of DB
        MERGE (d)-[:LOCATED_IN]->(r)
        MERGE (d)-[:CONNECTED_TO]->(g)
    end note
    
    DB - -> Service : result(nodesCreated, relsCreated)
    deactivate DB

    Service - -> UI : return SuccessDTO
end

deactivate Service

UI - -> User : 显示"拓扑关系已建立"
deactivate UI
deactivate User
@enduml

@startuml
title UC-02 维护图谱拓扑序列图
autonumber
skinparam sequence {
    LifeLineBorderColor #A80036
    LifeLineBackgroundColor #FEFECE
    ParticipantBorderColor #A80036
    ParticipantBackgroundColor #FEFECE
    ActorBorderColor #A80036
    ActorBackgroundColor #FEFECE
    ArrowColor #A80036
    BoxBorderColor #A80036
    BoxBackgroundColor #FFFFFF
}

actor "运维工程师" as User
participant ":Web管理门户" as UI
participant ":TopologyService" as Service
participant ":Device" as DeviceEntity
participant ":GraphAdapter\n(Neo4j)" as DB

activate User

User -> UI : 提交拓扑配置\n(deviceId, roomId, gatewayId)
activate UI

UI -> Service : bindTopology(cmd)
activate Service

Service -> Service : validateLogic()
activate Service #DarkSalmon
    note right: 校验网关容量、\n房间是否存在
deactivate Service

alt 校验失败
    Service - -> UI : throw ValidationException
    UI - -> User : 显示错误提示
else 校验通过
    Service -> DeviceEntity : updateLocation(roomId)
    activate DeviceEntity
    DeviceEntity - -> Service : ok
    deactivate DeviceEntity

    Service -> Service : buildMergeCypher()
    
    Service -> DB : execute(cypherStmt)
    activate DB
    note right of DB
        MERGE (d)-[:LOCATED_IN]->(r)
        MERGE (d)-[:CONNECTED_TO]->(g)
    end note
    
    DB - -> Service : result(nodesCreated, relsCreated)
    deactivate DB

    Service - -> UI : return SuccessDTO
end

deactivate Service

UI - -> User : 显示"拓扑关系已建立"
deactivate UI
deactivate User
@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 CST 2021)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>