<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="957px" preserveAspectRatio="none" style="width:1061px;height:957px;" version="1.1" viewBox="0 0 1061 957" width="1061px" zoomAndPan="magnify"><defs><filter height="300%" id="fb1du4ze3umkf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="219" x="420.25" y="30.6279">UC-02 构建拓扑关系流程图</text><rect fill="#E6F2FF" height="902.9961" style="stroke:#E6F2FF;stroke-width:1.0;" width="336" x="15" y="37.0381"/><path d="M20,96.6211 L20,159.8843 A0,0 0 0 0 20,159.8843 L168,159.8843 A0,0 0 0 0 168,159.8843 L168,132.2527 L188,128.2527 L168,124.2527 L168,106.6211 L158,96.6211 L20,96.6211 A0,0 0 0 0 20,96.6211 " fill="#FBFB77" filter="url(#fb1du4ze3umkf)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M158,96.6211 L158,106.6211 L168,106.6211 L158,96.6211 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="26" y="116.519">前置条件：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="26" y="134.2734">设备已通过UC-01完成</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="26" y="152.0278">双向证书认证并在线</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="152" x="188" y="110.0583"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="132" x="198" y="133.8103">选中待配置的新接入设备</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="154" x="187" y="292.6616"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="134" x="197" y="316.4136">指定物理空间 (楼宇/房间)</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="116" x="206" y="349.0503"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="216" y="372.8022">指定上行网关连接</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="128" x="200" y="861.6455"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="210" y="885.3975">查看并确认拓扑生效</text><ellipse cx="264" cy="929.0342" fill="#FFFFFF" filter="url(#fb1du4ze3umkf)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="264" cy="929.0342" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:2.0;" x1="15" x2="15" y1="37.0381" y2="940.0342"/><rect fill="#F2FFE6" height="902.9961" style="stroke:#F2FFE6;stroke-width:1.0;" width="502" x="351" y="37.0381"/><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="164" x="397.25" y="179.8843"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="407.25" y="203.6362">加载当前空间树与可用网关</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="168" x="395.25" y="236.2729"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="405.25" y="260.0249">解析MQTT元数据(辅助推荐)</text><path d="M563.25,395.439 L563.25,423.0706 L543.25,427.0706 L563.25,431.0706 L563.25,458.7021 A0,0 0 0 0 563.25,458.7021 L742.25,458.7021 A0,0 0 0 0 742.25,458.7021 L742.25,405.439 L732.25,395.439 L563.25,395.439 A0,0 0 0 0 563.25,395.439 " fill="#FBFB77" filter="url(#fb1du4ze3umkf)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M732.25,395.439 L732.25,405.439 L742.25,405.439 L732.25,395.439 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="569.25" y="415.3369">业务规则：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="569.25" y="433.0913">1. 网关必须在同一楼宇内</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="569.25" y="450.8457">2. 网关下挂设备数不能超限</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="128" x="415.25" y="408.8762"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="425.25" y="432.6282">校验拓扑逻辑有效性</text><polygon fill="#FEFECE" filter="url(#fb1du4ze3umkf)" points="454.25,478.7021,504.25,478.7021,516.25,490.7021,504.25,502.7021,454.25,502.7021,442.25,490.7021,454.25,478.7021" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="454.25" y="495.7966">校验通过?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="431.25" y="488.2852">否</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="516.25" y="488.2852">是</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="92" x="357" y="522.7021"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72" x="367" y="546.4541">返回错误提示</text><ellipse cx="403" cy="605.0908" fill="#FFFFFF" filter="url(#fb1du4ze3umkf)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="403" cy="605.0908" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><path d="M641,522.7021 L641,559.2109 L621,563.2109 L641,567.2109 L641,603.7197 A0,0 0 0 0 641,603.7197 L848,603.7197 A0,0 0 0 0 848,603.7197 L848,532.7021 L838,522.7021 L641,522.7021 A0,0 0 0 0 641,522.7021 " fill="#FBFB77" filter="url(#fb1du4ze3umkf)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M838,522.7021 L838,532.7021 L848,532.7021 L838,522.7021 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="647" y="542.6001">例如:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="647" y="560.3545">MATCH (r:Room {id: 'R101'})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="647" y="578.1089">MATCH (d:Device {id: 'D001'})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="647" y="595.8633">MERGE (d)-[:LOCATED_IN]-&gt;(r)</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="131" x="490" y="545.0166"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="111" x="500" y="568.7686">生成Cypher构建语句</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="116" x="497.5" y="805.2568"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="507.5" y="829.0088">更新前端拓扑画布</text><line style="stroke:#000000;stroke-width:2.0;" x1="351" x2="351" y1="37.0381" y2="940.0342"/><rect fill="#FFF2E6" height="902.9961" style="stroke:#FFF2E6;stroke-width:1.0;" width="189" x="853" y="37.0381"/><ellipse cx="869.25" cy="76.6211" fill="#000000" filter="url(#fb1du4ze3umkf)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="68" x="911.5" y="636.0908"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="48" x="921.5" y="659.8428">执行事务</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="133" x="879" y="692.4795"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="889" y="716.2314">创建设备节点 (Node)</text><rect fill="#FEFECE" filter="url(#fb1du4ze3umkf)" height="36.3887" rx="12.5" ry="12.5" style="stroke:#B22222;stroke-width:1.5;" width="173" x="859" y="748.8682"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="869" y="772.6201">建立关联关系 (Relationship)</text><line style="stroke:#000000;stroke-width:2.0;" x1="853" x2="853" y1="37.0381" y2="940.0342"/><line style="stroke:#000000;stroke-width:2.0;" x1="1042" x2="1042" y1="37.0381" y2="940.0342"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="264" y1="329.0503" y2="349.0503"/><polygon fill="#B22222" points="260,339.0503,264,349.0503,268,339.0503,264,343.0503" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="264" y1="898.0342" y2="918.0342"/><polygon fill="#B22222" points="260,908.0342,264,918.0342,268,908.0342,264,912.0342" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="479.25" x2="479.25" y1="216.2729" y2="236.2729"/><polygon fill="#B22222" points="475.25,226.2729,479.25,236.2729,483.25,226.2729,479.25,230.2729" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="403" x2="403" y1="559.0908" y2="594.0908"/><polygon fill="#B22222" points="399,584.0908,403,594.0908,407,584.0908,403,588.0908" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="442.25" x2="403" y1="490.7021" y2="490.7021"/><line style="stroke:#B22222;stroke-width:1.5;" x1="403" x2="403" y1="490.7021" y2="522.7021"/><polygon fill="#B22222" points="399,512.7021,403,522.7021,407,512.7021,403,516.7021" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="516.25" x2="555.5" y1="490.7021" y2="490.7021"/><line style="stroke:#B22222;stroke-width:1.5;" x1="555.5" x2="555.5" y1="490.7021" y2="545.0166"/><polygon fill="#B22222" points="551.5,535.0166,555.5,545.0166,559.5,535.0166,555.5,539.0166" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="555.5" x2="555.5" y1="841.6455" y2="846.6455"/><line style="stroke:#B22222;stroke-width:1.5;" x1="555.5" x2="264" y1="846.6455" y2="846.6455"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="264" y1="846.6455" y2="861.6455"/><polygon fill="#B22222" points="260,851.6455,264,861.6455,268,851.6455,264,855.6455" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="479.25" x2="479.25" y1="445.2649" y2="478.7021"/><polygon fill="#B22222" points="475.25,468.7021,479.25,478.7021,483.25,468.7021,479.25,472.7021" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="945.5" x2="945.5" y1="672.4795" y2="692.4795"/><polygon fill="#B22222" points="941.5,682.4795,945.5,692.4795,949.5,682.4795,945.5,686.4795" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="945.5" x2="945.5" y1="728.8682" y2="748.8682"/><polygon fill="#B22222" points="941.5,738.8682,945.5,748.8682,949.5,738.8682,945.5,742.8682" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="869.25" x2="869.25" y1="86.6211" y2="91.6211"/><line style="stroke:#B22222;stroke-width:1.5;" x1="869.25" x2="264" y1="91.6211" y2="91.6211"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="264" y1="91.6211" y2="110.0583"/><polygon fill="#B22222" points="260,100.0583,264,110.0583,268,100.0583,264,104.0583" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="264" y1="146.447" y2="164.8843"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="479.25" y1="164.8843" y2="164.8843"/><line style="stroke:#B22222;stroke-width:1.5;" x1="479.25" x2="479.25" y1="164.8843" y2="179.8843"/><polygon fill="#B22222" points="475.25,169.8843,479.25,179.8843,483.25,169.8843,479.25,173.8843" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="479.25" x2="479.25" y1="272.6616" y2="277.6616"/><line style="stroke:#B22222;stroke-width:1.5;" x1="479.25" x2="264" y1="277.6616" y2="277.6616"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="264" y1="277.6616" y2="292.6616"/><polygon fill="#B22222" points="260,282.6616,264,292.6616,268,282.6616,264,286.6616" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="264" y1="385.439" y2="390.439"/><line style="stroke:#B22222;stroke-width:1.5;" x1="264" x2="479.25" y1="390.439" y2="390.439"/><line style="stroke:#B22222;stroke-width:1.5;" x1="479.25" x2="479.25" y1="390.439" y2="408.8762"/><polygon fill="#B22222" points="475.25,398.8762,479.25,408.8762,483.25,398.8762,479.25,402.8762" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="555.5" x2="555.5" y1="581.4053" y2="610.0625"/><line style="stroke:#B22222;stroke-width:1.5;" x1="555.5" x2="945.5" y1="610.0625" y2="610.0625"/><line style="stroke:#B22222;stroke-width:1.5;" x1="945.5" x2="945.5" y1="610.0625" y2="636.0908"/><polygon fill="#B22222" points="941.5,626.0908,945.5,636.0908,949.5,626.0908,945.5,630.0908" style="stroke:#B22222;stroke-width:1.0;"/><line style="stroke:#B22222;stroke-width:1.5;" x1="945.5" x2="945.5" y1="785.2568" y2="790.2568"/><line style="stroke:#B22222;stroke-width:1.5;" x1="945.5" x2="555.5" y1="790.2568" y2="790.2568"/><line style="stroke:#B22222;stroke-width:1.5;" x1="555.5" x2="555.5" y1="790.2568" y2="805.2568"/><polygon fill="#B22222" points="551.5,795.2568,555.5,805.2568,559.5,795.2568,555.5,799.2568" style="stroke:#B22222;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="143" x="111.5" y="57.666">用户 (运维工程师)</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="187" x="508.5" y="57.666">IoT交互平台 (业务逻辑)</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="172" x="861.5" y="57.666">知识图谱引擎 (Neo4j)</text><!--MD5=[20715100a539d52a36a403878297b671]
@startuml
title UC-02 构建拓扑关系流程图
skinparam ActivityBackgroundColor #FEFECE
skinparam ActivityBorderColor #B22222
skinparam ArrowColor #B22222

|#E6F2FF|用户 (运维工程师)|
|#F2FFE6|IoT交互平台 (业务逻辑)|
|#FFF2E6|知识图谱引擎 (Neo4j)|

start

|用户 (运维工程师)|
:选中待配置的新接入设备;
note left
    前置条件：
    设备已通过UC-01完成
    双向证书认证并在线
end note

|IoT交互平台 (业务逻辑)|
:加载当前空间树与可用网关;
:解析MQTT元数据(辅助推荐);

|用户 (运维工程师)|
:指定物理空间 (楼宇/房间);
:指定上行网关连接;

|IoT交互平台 (业务逻辑)|
:校验拓扑逻辑有效性;
note right
    **业务规则：**
    1. 网关必须在同一楼宇内
    2. 网关下挂设备数不能超限
end note

if (校验通过?) then (否)
    |IoT交互平台 (业务逻辑)|
    :返回错误提示;
    stop
else (是)
    |IoT交互平台 (业务逻辑)|
    :生成Cypher构建语句;
    note right
        例如:
        MATCH (r:Room {id: 'R101'})
        MATCH (d:Device {id: 'D001'})
        MERGE (d)-[:LOCATED_IN]->(r)
    end note
    
    |知识图谱引擎 (Neo4j)|
    :执行事务;
    :创建设备节点 (Node);
    :建立关联关系 (Relationship);
    
    |IoT交互平台 (业务逻辑)|
    :更新前端拓扑画布;
endif

|用户 (运维工程师)|
:查看并确认拓扑生效;

stop
@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 CST 2021)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>