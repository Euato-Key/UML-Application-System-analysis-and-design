# 面向对象系统分析与设计实验三

## 项目概述

本项目是面向对象系统分析与设计实验三的实现，旨在通过大模型和知识图谱技术，完成从业务需求到代码实现的全流程开发，并建立完整的需求-用例-类-代码追踪链。

## 实验目的

1. 深入了解系统分析与设计的迭代过程
2. 加深对类模型、状态模型和交互模型的理解
3. 掌握包图与组件图的基本概念和绘制方法
4. 探索知识图谱技术在智能人机交互中的应用
5. 构建"需求-用例-类-代码-测试"五级追踪链
6. 实现变更影响的快捷定位与评估
7. 形成完整的需求分析与设计报告

## 项目结构

```
├── Prompt/                  # 实验各阶段使用的Prompt模板
├── neo4j-trace/             # Neo4j知识图谱构建与追踪工具
├── src/                     # 实验主要内容
│   ├── 1_biz/              # 业务获取与分析
│   ├── 2_req/              # 需求建模
│   ├── 3_design/           # 系统设计（UML图）
│   ├── 4_code/             # 代码实现
│   ├── 5_change/           # 变更管理
│   └── kg_dump/            # 知识图谱导出
└── 实验内容/                # 实验指导文档
```

## 技术栈

- **UML建模**：PlantUML
- **开发工具**：VS Code + PlantUML插件
- **大模型**：Kimi-128k 等
- **知识图谱**：Neo4j AuraDB
- **后端框架**：FastAPI (Python)
- **数据库**：Neo4j

## 实验步骤

### 1. 业务获取

- 访谈录音与转写
- 从访谈文本中抽取参与者与业务用例
- 生成业务用例图和业务术语表

### 2. 需求建模

- 生成功能清单和用例详述
- 绘制活动图描述用例流程
- 生成系统级用例图

### 3. 系统架构与构件

- 设计类图、包图和序列图
- 建立需求到类的追踪关系
- 将设计模型导入知识图谱

### 4. 代码骨架与双向追踪

- 生成FastAPI代码骨架
- 在代码中添加追踪标记
- 建立类到代码的双向追踪

### 5. 变更管理

- 模拟需求变更场景
- 使用知识图谱分析变更影响范围
- 增量生成代码和测试用例

## 使用说明

### 知识图谱构建

```bash
cd neo4j-trace
python kg_build.py --stage requirement --files ../src/2_req/*.puml ../src/3_design/*.puml
```

### 代码追踪

```bash
cd neo4j-trace
python kg_trace.py --direction both --code ../src/4_code/iot-kg-platform/app
```

### Neo4j查询

在Neo4j浏览器中执行以下查询查看追踪链：

```cypher
MATCH (uc:UseCase)-[*]->(f:CodeFile)
RETURN uc.name, collect(DISTINCT type(r)) as relationships, f.path
LIMIT 10
```

## 知识图谱结构

### 实体（节点）

- **UseCase**：用例节点，如UC01: 注册接入设备
- **Class**：类节点，如Device、Space
- **CodeFile**：代码文件节点，如models.py
- **Activity**：活动节点
- **UMLFile**：UML文件节点

### 关系（边）

- **SUPPORTS**：类支持用例
- **IMPLEMENTS**：代码文件实现类
- **TRACE**：代码追踪到用例
- **HAS_ATTRIBUTE**：类拥有属性
- **HAS_DIAGRAM**：用例拥有图表

## 变更管理

当需求变更时，使用以下步骤进行影响分析：

1. 在Neo4j浏览器中执行变更影响分析脚本
2. 输入变更用例编号，如UC05
3. 查看高亮显示的受影响类、方法和代码文件
4. 基于分析结果进行增量开发

## 常见问题

### Q1: 没有显卡怎么办？
- 使用Kimi-128k在线版，PlantUML生成后拷贝回本地

### Q2: LLM生成的属性不合理？
- 先定义业务术语表，再让LLM只使用表中词汇

### Q3: Neo4j端口冲突？
- 修改conf/neo4j.conf文件中的端口配置
- `dbms.connector.bolt.listen_address=:7688`

## 评价标准

| 维度 | 分值 | 说明 |
|------|------|------|
| 业务用例分析 | 25 | 参与者齐全、命名规范 |
| 需求追踪链 | 20 | Neo4j中"UC→Class→Code"三级完整 |
| 首版类图/序列图 | 15 | 与代码保持一致 |
| 变更影响报告 | 20 | 能高亮≥5个受影响节点 |
| 文档规范 | 10 | 模板统一、走查清单签字 |
| 团队互评 | 10 | 现场互评问卷 |

## 项目成果

- 完整的业务分析文档
- 需求建模文档与UML图
- 系统设计文档与UML图
- 可运行的FastAPI代码
- 基于Neo4j的知识图谱
- 变更影响分析报告

## 参考文献

- 《面向对象系统分析与设计》
- Neo4j官方文档
- PlantUML用户指南
- FastAPI文档

## 联系方式

如有问题，请联系项目组成员。

---

© 2025 面向对象系统分析与设计实验三项目组